---

title: Lab &ndash; Vulnerability Scanning
number: 6
---

# Objective

The objective of this lab is to create a report of potential vulnerabilities for a virtual machine. The deliverable for this lab is your report and this document with your answers to questions below (submitted on D2L). 
The VM is a Ubuntu-based Linux distribution called MetaSploitable2, which is specifically designed to teach penetration testing skills such as vulnerability scanning.

# Setup VMs

<div class='alert alert-info'>Skip this entire section if you're using the VMs I distributed in class.</div>

## Network Configuration

Each of your VMs should have two network adapters. The following is the only setup I've been able to get working while on campus.

To configure network adapters, power off the VM, select it, and click "Settings" on the top. Then choose "Network" on the left.

* For `Adapter 1`, choose 'NAT'.
* For `Adapter 2`, check 'Enable Network Adapter', and select 'Host-only Adapter' from the first drop-down.

![image_4](../images/lab_6_1.png){: width="500px" }

NAT should give your VMs internet access, and 'Host-only Adapter' should let your VMs talk to one another, including the host computer.

You can change your network config settings at any time if you first power off the VM.



## Setup Kali Linux VM


<div class='alert alert-info'>In lieu of following these instructions, consider using a ready-to-go version of Kali that I have prepared. Ask me for a copy.</div>

Follow the instructions [here](http://www.wikigain.com/install-kali-linux-virtualbox-pc/), except:

* Use 20GB instead of 15GB for the dynamic disk size (just to be safe).
* For the "Configure the Network" step, choose the network interface that was your 'NAT' option. e.g., If NAT was your first adapter, choose the first entry.
* For Step 7 "Partition disks" step, choose "Guided - use entire disk" to save yourself extra work. Choose "All files in one partition" a few steps later on, too. Continue the instructions with Step 16.
* Consider using 'Password1' as the password for all VMs for this class. This is fine because the VMs aren't accessible from outside your laptop with the network adapter settings we've chosen.
* After you've installed Kali, the first thing you should do is log in and open a terminal (select the `Applications` menu in the top left of the screen, and selecting `Accessories` —> `Terminal`), and run these commands:
    * `systemctl enable smbd && service smbd start`. This will help Kali get internet via NAT.
    * `apt-get update && apt-get upgrade -y`. This might take a while. It will make sure your system is up-to-date.
    * `apt-get dist-upgrade`
    * `apt-get install -y virtualbox-guest-x11 && reboot`. This should give you nice things like shared clipboard between your host and Kali, and fullscreen.
    * speaking of shared clipboard, do 'Devices' > 'Shared Clipboard' > 'Bidirectional'.
    * `systemctl enable postgresql && service postgresql start`
	* Kali doesn't seem to get internet automatically by itself. You can create a script, say /root/get-internet.sh, and put in these contents:
			
			#!/bin/sh			
			
			ifconfig eth0 up
			dhclient eth0
			
			exit 0
	  
	  Then run `crontab -e` and add a line like:
			
			@reboot /root/get-internet.sh
			
    
	  If you ever don't have an internet connection after rebooting, try running <code>dhclient eth0</code> (assuming your NAT interface is your first one).
    


## Setup Metasploitable VM

It's easy. Follow [this link](https://hackercool.com/2013/09/how-to-install-metasploitable-in-virtualbox/).



<div class='alert alert-warning'>Ensure that you can <code>ping</code> each VM from each VM before continuing the lab. Use `ifconfig` from a terminal to see the IP addresses, and use the `192.` one associated with the Host-Only adapter you set up earlier.</div>


# Part 1. Host Discovery and Scanning using NMAP


NMAP is the de facto standard of host discovery and port scanning and has a host of features that make the tool very robust. In this section of the lab, you’ll try a few of NMAP’s features.

1.	Open a terminal window in Kali by selecting the `Applications` menu in the top left of the screen, and selecting `Accessories` —> `Terminal.`
2.	Type `nmap.` Take a quick look at the available options.
3.	Use nmap to determine whether the your Metasploitable2 VM is live using a ping scan:	

        nmap -sn [IP of VM]

    The ping scan not only sends an ICMP request, but also an ARP ping, TCP pinging, and other techniques to determine if a host is live on the network.

4.	You can also scan a range of IPs using CIDR block notation. My "Host-Only Network" range is 192.168.56.0/24, meaning all of my addresses for that network are between 192.168.56.1 -- 192.168.56.255. So I would type:

        nmap -sn 192.168.56.0/24

    **Question:** What information is shown for your Metasploitable VM, besides its IP address?

5.	Once you determine that a host is live, you can use NMAP to scan for open ports. Use a TCP scan to determine which ports are open on Metasploitable2:

        nmap -sS [IP of VM]

    This scans approximately 1,800 of the most common TCP ports on the target machine.

    **Question:** Which ports are open on the Metasploitable2 VM?


6.	You can also specify additional ports to scan. Scan the first 10,000 ports of the Metasploitable2 VM:

        nmap -sS -p1-10000 [IP of VM]

    **Question:** Did you find any additional ports?

7.	Nmap can provide additional information about open ports by interrogating the ports it finds using the “sV” flag:

        nmap -sV [IP of VM]

    **Note:** Press the “enter” key to see a status of the NMAP scan.

8.	You can get further information still by using the advanced flag (“-A”).

        nmap -sV -A [IP of VM]

    **Question:** What additional information about the open ports on Metasploitable2 were you able to obtain by using the -sV and -A flags?

9.	A useful feature of nmap is operating system fingerprinting which it accomplishes by profiling how a system responds to its scans. 

        nmap -O [IP of VM]

    **Note:** That’s a capital “oh” not a “zero.”

    **Question:** What operating system does nmap report Metasploitable2 to be? 

10.	Now scan for web applications on Metasploitable2. Increasingly, applications run off of a different URL, all using port 80.

        nmap -sV --script=http-enum [IP of VM]

    **Question:** What web applications are available on Metasploitable2?
    
    
    
# Part 2. Nessus

1.	Register for a Nessus Home license. Browse to the URL below and enter your name and email address:
        
    [https://www.tenable.com/products/nessus-home](https://www.tenable.com/products/nessus-home)

2.	(Note: Nessus is already installed on the lab VM, skip this step if you're using the VM I provided.) Download Nessus to your Kali machine from [here](https://www.tenable.com/products/nessus/select-your-operating-system#tos). 
	Navigate to your Download directory and run `dpkg -i <filename of your download>` to install Nessus. 
	
2.	After you receive the email from Tenable containing your serial number, type in the following command in the Kali terminal:

        /opt/nessus/sbin/nessuscli fetch --register <serial>

    Where `<serial>` is the serial number you received in the email from Tenable. You should see a message saying that your activation code has been registered properly. 
    
    
3.	In the Kali VM, open a terminal and type `service nessusd start`

4.	On the Firefox web browser, navigate to `https://kali:8834` to open the Nessus web interface (note the “s”). (Click 'Advanced' > 'Add Security Exception' > 'Confirm Security Exception' to get past the SSL warning.)

5.	Login with username “labuser” and password “Password1”. Click the “reload” if the page fails to load.

6.	Click the “Policies” tab and press the “New Policy” button. 

    1.	Choose “Basic Network Scan”
    
    2.	Name the policy “Custom.”
    
    3.	Under the category “Discovery,” change the “Scan Type” to “All ports.”
	
	1.	Under “Assessment”, change the dropdown to "Scan for known web vulnerabilities."
	
	1.	Under “Advanced”, select Scan Type "Custom". Then select “General” on the left. Uncheck “Enable safe checks.”
	
	1. 	Save your new custom policy.
	
    
7.	Click the “Scans” tab and press the “New Scan” button.

    1. Select the "User Defined" tab. Choose your Custom policy.
	
	1.	In the “Name” field, enter Metasploitable2. In the “Targets” field, enter the IP address of the MetaSploitable2 VM (the 192. one)
    
    1.	Click the “Save” button, then click the “Scans” tab at the top of the web page. Next, on row of the Metasploitable2 scan you just created, click the triangle symbol to launch the scan.

8.	In the Scans tab you should see the scan job running. This should take about 10 minutes to complete. In the meantime, you can click the job to see the vulnerabilities that Nessus has found so far. Vulnerabilities can be sorted by severity.

**Questions:**

* Do you think it would be difficult to compromise this system? Explain. 
* Which vulnerabilities are critical? Of these, which appear to be most serious? Double-click a vulnerability in the report and read the description.
* What would be the first thing you would do to secure this system?


    






